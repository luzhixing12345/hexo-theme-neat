<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/prism.css /><link rel='stylesheet' href=../../../css/index.css />
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/luzhixing12345/zood.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">安装与构建</a><ul><li><a href="#h2-1">标准构建方式</a></li></ul><ul><li><a href="#h2-2">可能遇到的问题</a></li></ul><ul><li><a href="#h2-3">一些补充信息</a></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">安装与构建</h1><p>gem5的安装是及其头痛的,由于gem5并未提供发行版而是采用了源码编译的方式,笔者付出了相当多的编译等待时间和错误处理时间</p><p>一旦完成构建, 我们就可以在 gem5 源码的基础上进行改进, 再次编译构建的速度就会快很多了</p><h2 id="h2-1">标准构建方式</h2><p>使用Ubuntu22.04操作系统,双系统,英文语言,gcc版本11.3.0,32G交换区</p><p>gem5的编译强烈建议使用双系统,在虚拟机中启动gem5模拟有点太慢了</p><p><b>内存分配至少8GB</b>,不然编译可能因为内存不足而失败.<b>不要使用低版本gcc</b></p><blockquote><p>不想装双系统麻烦的话 WSL2 也是一个不错的选择</p></blockquote><ul><li>安装依赖之前<pre><code class="language-bash">sudo apt update
sudo apt install vim</code></pre></li></ul><ul><li>安装依赖<pre><code class="language-bash">sudo apt install build-essential git m4 scons zlib1g zlib1g-dev \
    libprotobuf-dev protobuf-compiler libprotoc-dev libgoogle-perftools-dev \
    python3-dev python-is-python3 libboost-all-dev pkg-config libhdf5-dev libpng-dev</code></pre></li></ul><ul><li>克隆代码<pre><code class="language-bash">git clone https://gem5.googlesource.com/public/gem5</code></pre><p>如果还没配置代理则使用如下gitee源</p><pre><code class="language-bash">git clone https://gitee.com/koverlu/gem5.git
# git clone -c http.sslVerify=false https://gitee.com/koverlu/gem5.git/</code></pre></li></ul><ul><li>进入目录并开始编译<pre><code class="language-bash">cd gem5
scons build/X86/gem5.opt -j 4</code></pre><blockquote><p>最后j后面的数字为开启的线程数,并无大影响,改为2,8都可以</p></blockquote></li></ul><ul><li>等待一段时间,最后编译成功, 没有任何warnning<pre><code class="language-bash">...
scons: done building targets</code></pre><p>可以在 <code>gem5/build/X86/</code>下找到 <code>gem5.opt</code></p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230501225850.png" alt="20230501225850"></p></li></ul><h2 id="h2-2">可能遇到的问题</h2><p>这里总结一下笔者初次编译时遇到的诸多问题</p><ol start="1"><li>选择构建的系统和 gcc 版本<p>官方推荐使用的Ubuntu操作系统(本机或者服务器,不推荐虚拟机). 笔者个人的服务器是Debian10,gcc版本为 8.3.0 ,2核2G.尽管官方给出的gcc要求如下</p><pre><code class="language-bash">gcc: gcc is used to compiled gem5. Version &gt;=7 must be used. We support up to gcc Version 11.</code></pre><p>但实际上如果不使用gcc11进行编译会报如下的一个警告,然后在最后链接显示失败</p><pre><code class="language-bash">Warning:
      Deprecated namespaces are not supported by this compiler.</code></pre><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/217302a0c1001c0821d89a3f3d973bf.png" alt="217302a0c1001c0821d89a3f3d973bf"></p><p>所以推荐直接使用Ubuntu22.04,默认安装的gcc 11.3.0,不会出现此问题</p><p>笔者也尝试Debian去安装高版本gcc结果失败,似乎只能从源码编译,但这一过程又太过麻烦,故放弃</p><blockquote><p>gcc 源码编译会有很多中间文件,且会自编译三次时间很长...</p></blockquote><p>笔者也尝试了使用docker镜像创建容器去编译,但由于服务器内存不足在最后链接的过程失败</p><p><b>解决办法</b>: 最后笔者选择了使用本机安装Win11与Ubuntu22.04双系统,分配了8GB swap area,成功编译</p><p><b>注意</b>,Ubuntu系统安装请务必使用 <b>英文</b>, 中文系统会在编译初期产生如下报错</p><pre><code class="language-bash">pybind11::error_already_set
what(): UnicodeDecodeError: &#x27;ascii&#x27; codec an&#x27;t decode byte 0xe6 in position 78:ordinal not in range(128</code></pre><p>暂时未找到直接的解决办法,笔者的解决办法是重装系统,语言选择英语.后期再去下中文输入法</p><blockquote><p>如果没有装过双系统可以参考<a href="https://luzhixing12345.github.io/2022/11/15/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/" target="_blank">双系统安装</a></p></blockquote></li></ol><ol start="2"><li>两个warnning<pre><code class="language-bash">Warning: Header file &lt;png.h&gt; not found.
            This host has no libpng library.
            Disabling support for PNG framebuffers.
Checking for clock_nanosleep(0,0,NULL,NULL) in C library None... yes
Checking for C header file valgrind/valgrind.h... no
Checking for pkg-config package hdf5-serial... no
Checking for pkg-config package hdf5... no
Checking for H5Fcreate(&quot;&quot;, 0, 0, 0) in C library hdf5... no
Warning: Couldn&#x27;t find HDF5 C++ libraries. Disabling HDF5 support.</code></pre><p>如果出现如上的两个警告则还需要安装两个库</p><pre><code class="language-bash">sudo apt-get install libhdf5-dev
sudo apt-get install libpng-dev</code></pre><blockquote><p>笔者这里已经贴心的将其加入到 <code>安装依赖</code> 所需的库的最后了</p></blockquote></li></ol><ol start="3"><li>Python 找不到<pre><code class="language-bash">Error: Can&#x27;t find a suitable python-config, tried [&#x27;python3-config&#x27;,&#x27;python-config&#x27;]
Error: Can&#x27;t find a working Python installation</code></pre><p>这个很有可能是因为当前处于anaconda的虚拟环境,这里的安装需要使用系统的python3来进行安装.可使用如下命令退出conda环境</p><pre><code class="language-bash">conda deactivate</code></pre><p>或者此时应该会出现黄色的提示,提醒你指出使用的python的绝对路径,按其提示即可</p></li></ol><ol start="4"><li>python版本不对<p>可以使用如下命令代替 <code>scons build/X86/gem5.opt -j4</code></p><pre><code class="language-bash">python3 `which scons` build/X86/gem5.opt</code></pre><p>Ubuntu为了向前兼容默认是python2,需要使用python3</p></li></ol><ol start="5"><li>其他问题<p>这些问题笔者并没有经历,官网给出了构建过程中可能出现的一些问题的解答</p><pre><code class="language-bash">M4 macro processor not installed
Protobuf 3.12.3 problem
Wrong gcc version</code></pre><p>或许你可以在 <a href="https://www.gem5.org/documentation/learning_gem5/part1/building" target="_blank">https://www.gem5.org/documentation/learning_gem5/part1/building</a>/ 找到答案</p><p>除此之外你可以到<a href="https://www.mail-archive.com/gem5-users@gem5.org/" target="_blank">gem5-user</a>去查询相关回答</p></li></ol><h2 id="h2-3">一些补充信息</h2><p>不过开始之前我们先稍作更改以方便我们后续的工作, 修改 <code>～/.bashrc</code> 并添加一个别名 alias</p><pre><code class="language-bash">alias gem5=/home/kamilu/gem5/build/X86/gem5.opt</code></pre><p>这里的路径你需要换成你的, 我们使用 gem5 来替代指明这个 gem5.opt 的绝对路径, 以后可以很方便的直接使用 gem5 调用了</p><blockquote><p>source ~/.bashrc 激活环境</p></blockquote><p>接着我们注意到在开始编译之前 gem5 会输出一些信息, gem5建议安装 pre-commit</p><pre><code class="language-bash">pip install -r requirements.txt
sudo apt install pre-commit</code></pre><blockquote><p>这里需要注意的是如果安装 pre-commit 之后 commit message 需要满足 <code>MAINTAINERS.yaml</code> 的检查, 具体可参考 commit 时候的输出提示</p></blockquote><p><b>不过我个人并不建议安装 pre-commit</b>, 因为他会要求强制修改你的 commit message 习惯, 对我而言有一些难受</p><pre><code class="language-bash">sudo apt rmeove pre-commit
rm -r .git/hooks</code></pre><p>不过每次编译的时候都会提示使用 pre-commit 有点烦, 我们可以采用一个强硬一点的办法</p><p>修改 site_scons/git.py 110 行的函数, 直接返回忽略检查</p><pre><code class="language-python">def generate(env):
    return
    if exists(env) and not gem5_scons.util.ignore_style():
        install_style_hooks(env)</code></pre><hr><p>此外我们注意到上述的输出信息中包含这样一行警告: <code>warn: No dot file generated. Please install pydot to generate the dot file and pdf.</code>, 这个的意思是我们缺少一个绘图的工具</p><pre><code class="language-bash">pip install pydot
sudo apt install graphviz</code></pre><blockquote><p>你可以使用 <code>dot -V</code> 查看 graphviz 版本</p></blockquote><p>安装完成之后再次执行会发现生成的 m5out (这是一个默认的输出信息文件夹) 中多了pdf和svg文件, 其中 svg 文件</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230331115911.png" alt="20230331115911"></p><p>如果您希望使用 png 格式的图片</p><pre><code class="language-bash">dot -Tpng -o config.png config.dot</code></pre></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../快速开始/安装与使用" >快速开始</a><ul><li><a href="../../快速开始/安装与使用" >安装与使用</a></li></ul><ul><li><a href="../../快速开始/配置信息" >配置信息</a></li></ul><ul><li><a href="../../快速开始/功能演示" >功能演示</a></li></ul><ul><li><a href="../../快速开始/代码高亮" >代码高亮</a></li></ul></li></ul><ul><li><a href="../../API/zood init" >API</a><ul><li><a href="../../API/zood init" >zood init</a></li></ul><ul><li><a href="../../API/zood config" >zood config</a></li></ul><ul><li><a href="../../API/zood -g" >zood -g</a></li></ul></li></ul><ul><li><a href="../../a/1" >a</a><ul><li><a href="../../a/1" >1</a></li></ul><ul><li><a href="../../a/2" >2</a></li></ul><ul><li><a href="../../a/3" >3</a></li></ul><ul><li><a href="../../a/4" >4</a></li></ul><ul><li><a href="../../a/5" >5</a></li></ul><ul><li><a href="../../a/6" >6</a></li></ul><ul><li><a href="../../a/7" >7</a></li></ul><ul><li><a href="../../a/1111111111111111111" >1111111111111111111</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../API/zood -g","../../a/2","ab")</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png")</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/before_copy.png","../../../img/after_copy.png")</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/prism.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/search.js"></script><script>addSearchBar("{\"../../md-docs/README\": \"zoodzoodzood \u7f51\u9875\u6587\u6863\u751f\u6210\u7684 python \u5e93, \u53ef\u4ee5\u5c06\u672c\u5730 Markdown \u6587\u4ef6\u8f6c\u4e3a Web \u7f51\u9875zood \u7684\u9875\u9762\u98ce\u683c\u66f4\u503e\u5411\u4e8e\u7eaf\u6587\u6863\u5185\u5bb9\u800c\u975e\u535a\u5ba2, \u60a8\u53ef\u5229\u7528 Github Pages \u4e3a\u6bcf\u4e00\u4e2a\u4ed3\u5e93\u90e8\u7f72\u5355\u72ec\u7684\u7f51\u9875\u6587\u6863zood \u57fa\u4e8e MarkdownParser \u5b8c\u6210 Markdown \u6587\u4ef6\u7684\u89e3\u6790\u548c\u8f6c\u6362\u60a8\u53ef\u524d\u5f80 \u3010\u9879\u76ee\u5206\u4eab\u3011zood:\u9879\u76ee\u6587\u6863\u751f\u6210\u5de5\u5177 \u6d4f\u89c8\u4e00\u4e2a\u76f8\u5173\u89c6\u9891\u4ecb\u7ecd\u6b22\u8fce\u5404\u4f4d\u63d0\u51fa\u5b9d\u8d35\u4f7f\u7528\u5efa\u8bae, \u65b0\u589e\u529f\u80fd\u9700\u6c42, \u4ee5\u53ca\u62a5\u544abug\", \"../../API/zood init\": \"zood init\u6458\u8981\u672f\u8bed\u8868zood init\u8fd9\u90e8\u5206\u5185\u5bb9\u7528\u4e8e\u6d4b\u8bd5\u641c\u7d22\u6458\u8981\u4e09\u79cdCXL\u534f\u8bae\u8ba8\u8bba\u4e86\u6700\u4f18\u7684PCIe\u5b58\u50a8\u8bbe\u5907\u9009\u62e9(Type3)\u505a\u5bf9\u6bd4\u5b9e\u73b0\u8ba8\u8bbaCXL\u5e26\u6765\u4e86\u7684\u6027\u80fd\u63d0\u5347\u63a2\u7d22\u7f51\u7edc\u62d3\u6251\u548c\u7ba1\u7406\u5185\u5b58\u6269\u5c55\u7684\u65b9\u5f0f\u672f\u8bed\u8868\u540d\u8bcd\u91ca\u4e49                BARs                PCIe base address registers                FlexBus                CXL.io\u521b\u5efa\u7684\u9ad8\u901fIO\u901a\u9053                CXL RP                CXL root port                HDM                host-managed device memory                CXL flit                \u4e3b\u673a\u8bbe\u5907\u901a\u8fc7CXL RP\u53d1\u9001\u7ed9type3\u8bbe\u5907\u7528\u4e8e\u540c\u6b65\u7684\u4fe1\u606f                USP                upstream ports                DSP                downstream ports                fabric manager                swicth&#x27;s crossbar,\u4ea4\u6362\u673a\u8fde\u63a5USP,DSP\u7684\u90e8\u5206                VH                virtual hierarchy                MLD                multiple logical device                GPF                global persistent flush                DT                deterministic                ND                non-deterministic                BF                bufferable                NB                non-bufferable\", \"../../API/zood config\": \"zood configzood configasdjl  qweuasdoj zood config asdjklqw qwejlVue (\u53d1\u97f3\u4e3a /vju\u02d0/\uff0c\u7c7b\u4f3c view) \u662f\u4e00\u6b3e\u7528\u4e8e\u6784\u5efa\u7528\u6237\u754c\u9762\u7684 JavaScript \u6846\u67b6\u3002\u5b83\u57fa\u4e8e\u6807\u51c6 HTML\u3001CSS \u548c JavaScript \u6784\u5efa\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u5957\u58f0\u660e\u5f0f\u7684\u3001\u7ec4\u4ef6\u5316\u7684\u7f16\u7a0b\u6a21\u578b\uff0c\u5e2e\u52a9\u4f60\u9ad8\u6548\u5730\u5f00\u53d1\u7528\u6237\u754c\u9762\u3002\u65e0\u8bba\u662f\u7b80\u5355\u8fd8\u662f\u590d\u6742\u7684\u754c\u9762\uff0cVue \u90fd\u53ef\u4ee5\u80dc\u4efb\u3002\", \"../../API/zood -g\": \"zood -ggem5-cxlzood -gjust a test for me?tooooooooooooooooooooooooooo longgggggggggggggggggggg codeeeeeeeeeeeeeeeeeeeeeee tooo copyhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhgem5-cxl\u672c\u6587\u6863\u7528\u4e8e\u8bb0\u5f55gem5\u7684\u7f16\u8bd1\u548c\u4f7f\u7528gem5\u6e90\u7801\u9605\u8bfbcxl\u7684gem5\u5b9e\u73b0cxl\u9a71\u52a8\u5b9e\u73b0\"}","../../../img/search.svg","../../../img/enter.svg","Ctrl+K")</script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>